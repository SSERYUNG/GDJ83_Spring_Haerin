<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.sun.app.boards.qnas.QnaDAO">
<sql id="searchSql">
			<where>
				BOARDNUM>0
				<choose>
					<when test="kind=='title'">
						AND BOARDTITLE
					</when>
					<when test="kind=='contents'">
						AND BOARDCINTENTS
					</when>
					<otherwise>
						AND BOARDWRITER
					</otherwise>
				</choose>
				LIKE '%' || #{search} || '%'
			</where>
</sql>

<select id="getTotalCount" parameterType="Pager" resultType="java.lang.Long">
		SELECT COUNT(BOARDNUM) FROM QNA
		<include refid="searchSql"></include>
</select>

	<select id="list" parameterType="Pager" resultType="QnaDTO">
	SELECT * FROM
	(
		SELECT ROWNUM R, Q.* FROM
		(
			SELECT * FROM QNA
				<include refid="searchSql"></include>
			ORDER BY REF DESC, STEP ASC
		)Q
		)
		WHERE R BETWEEN #{startRow} AND#{lastRow}
	</select>
	<insert id="add" parameterType="QnaDTO">
			INSERT INTO QNA
			(BOARDNUM, BOARDWRITER,BOARDTITLE,BOARDCONTENTS,CREATEDATE,
			UPDATEDATE,BOARDHIT,BOARDCATEGORY,REF,STEP,DEPTH
			)
			VALUES
			( 
			BOARD_SEQ.NEXTVAL, #{boardWriter},#{boardTitle},#{boardContents},SYSDATE,
			SYSDATE,0,'Q', BOARD_SEQ.CURRVAL,0,0
			)
	</insert>
	<select id="detail" parameterType="QnaDTO" resultType="QnaDTO">
	SELECT * FROM QNA WHERE BOARDNUM=#{boardNum}
	</select>
</mapper> 

  